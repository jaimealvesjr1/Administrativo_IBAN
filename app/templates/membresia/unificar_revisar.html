{% set show_navbar = true %}
{% extends 'base/layout.html' %}
{% from 'base/components/buttons.html' import primary %}
{% block title %}Revisar Unificação · IBAN{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4"><strong>Revisar Unificação de Cadastros</strong></h2>
    <p class="text-muted">Selecione os dados que deseja manter para o cadastro unificado.</p>

    <form method="POST" action="{{ url_for('membresia.unificar_processar') }}">
        <input type="hidden" name="membro_principal_id" value="{{ dados_membros[0].id }}">
        
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th style="width: 20%;">Campo</th>
                        {% for membro in dados_membros %}
                        <th style="width: {{ 80 / dados_membros|length }}%;">
                            Membro: {{ membro.nome_completo }} (ID: {{ membro.id }})
                            <input type="hidden" name="membros_a_excluir[]" value="{{ membro.id }}">
                        </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Nome Completo</td>
                        {% for membro in dados_membros %}
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="nome_completo" id="nome_completo_{{ membro.id }}" value="{{ membro.nome_completo }}" {% if loop.index == 1 %}checked{% endif %}>
                                <label class="form-check-label" for="nome_completo_{{ membro.id }}">{{ membro.nome_completo }}</label>
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>Data de Nascimento</td>
                        {% for membro in dados_membros %}
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="data_nascimento" id="data_nascimento_{{ membro.id }}" value="{{ membro.data_nascimento }}" {% if loop.index == 1 %}checked{% endif %}>
                                <label class="form-check-label" for="data_nascimento_{{ membro.id }}">{{ membro.data_nascimento|format_datetime(format="%d/%m/%Y") if membro.data_nascimento else 'N/A' }}</label>
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>Status</td>
                        {% for membro in dados_membros %}
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" id="status_{{ membro.id }}" value="{{ membro.status }}" {% if loop.index == 1 %}checked{% endif %}>
                                <label class="form-check-label" for="status_{{ membro.id }}">{{ membro.status }}</label>
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>Campus</td>
                        {% for membro in dados_membros %}
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="campus" id="campus_{{ membro.id }}" value="{{ membro.campus }}" {% if loop.index == 1 %}checked{% endif %}>
                                <label class="form-check-label" for="campus_{{ membro.id }}">{{ membro.campus }}</label>
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>Email (Acesso)</td>
                        {% for membro in dados_membros %}
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="email" id="email_{{ membro.id }}" value="{{ membro.email if membro.email else 'N/A' }}" {% if loop.index == 1 %}checked{% endif %}>
                                <label class="form-check-label" for="email_{{ membro.id }}">{{ membro.email if membro.email else 'N/A' }}</label>
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>Permissões</td>
                        {% for membro in dados_membros %}
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="permissoes" id="permissoes_{{ membro.id }}" value="{{ membro.permissoes if membro.permissoes else 'N/A' }}" {% if loop.index == 1 %}checked{% endif %}>
                                <label class="form-check-label" for="permissoes_{{ membro.id }}">{{ membro.permissoes if membro.permissoes else 'N/A' }}</label>
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <a href="{{ url_for('membresia.unificar_membros') }}" class="btn btn-outline-secondary">Voltar</a>
            <button type="submit" class="btn btn-primary" onclick="return confirm('Tem certeza que deseja unificar os cadastros com as informações selecionadas? Esta ação é irreversível.');">Confirmar Unificação</button>
        </div>
    </form>
</div>
{% endblock %}
